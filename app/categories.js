// ===============================
// âœ… Categories (mantive como vocÃª enviou; vocÃª pode deixar os arrays originais)
// ===============================

export const LIFESTYLE_CATEGORIES = [
  "Accessories",
  "Active Life",
  "Adult Education",
  "Adult Entertainment",
  "Air",
  "Amusement Parks",
  "Appliances",
  "Appliances & Repair",
  "Arcades",
  "Arabic",
  "Armenian",
  "Art Galleries",
  "Arts & Crafts",
  "Arts & Entertainment",
  "Auto",
  "Auto Detailing",
  "Auto Glass Services",
  "Auto Repair",
  "Automotive",
  "Banks",
  "Banks & Credit Unions",
  "Bar",
  "Bar Crawl",
  "Barbers",
  "Barista",
  "Bars",
  "Bartenders",
  "Battery",
  "Battery Stores",
  "Batting Cages",
  "Beaches",
  "Beauty & Spas",
  "Bed & Breakfast",
  "Beer",
  "Beer Bar",
  "Beer Gardens",
  "Beer Hall",
  "Beer Tours",
  "Boating",
  "Boat",
  "Boat Charters",
  "Boat Tours",
  "Body Shops",
  "Books",
  "Bookstores",
  "Bowling",
  "Business",
  "Business Consulting",
  "Cabaret",
  "Cafes",
  "Cafeteria",
  "Cannabis Dispensaries",
  "Car",
  "Car Dealers",
  "Car Stereo Installation",
  "Cards & Stationery",
  "Casinos",
  "Child Care & Day Care",
  "Children",
  "Children's Clothing",
  "Chiropractors",
  "Chocolatiers & Shops",
  "Christmas Trees",
  "Churches",
  "Cinema",
  "Cleaning",
  "Clubs",
  "Cocktail Bars",
  "Comedy",
  "Comedy Clubs",
  "Community Service/Non-Profit",
  "Computer",
  "Conditioning",
  "Convenience Stores",
  "Cosmetics",
  "Cosmetics & Beauty Supply",
  "Counseling & Mental Health",
  "Country",
  "Country Clubs",
  "Crane",
  "Crane Services",
  "Crafts",
  "Dance Clubs",
  "Day Spas",
  "Department Stores",
  "Departments of Motor Vehicles",
  "Doctors",
  "Dog Parks",
  "Drugstores",
  "Dry Cleaning & Laundry",
  "Education",
  "Educational",
  "Educational Services",
  "Electronics",
  "Electronics Repair",
  "Entertainment",
  "Equipment",
  "Event Planning & Services",
  "Events",
  "Eyewear & Opticians",
  "Fashion",
  "Festivals",
  "Financial",
  "Financial Services",
  "Fireworks",
  "Fishing",
  "Fitness & Instruction",
  "Florists",
  "Flowers",
  "Flowers & Gifts",
  "Food Stands",
  "Funeral",
  "Funeral Services & Cemeteries",
  "Furniture",
  "Furniture Stores",
  "Galleries",
  "Gas",
  "Gas Stations",
  "Gastropubs",
  "Gear",
  "Gifts",
  "Go Karts",
  "Golf",
  "Golf Equipment",
  "Golf Lessons",
  "Gun",
  "Gun/Rifle Ranges",
  "Guns & Ammo",
  "Hair",
  "Hair Removal",
  "Hair Salons",
  "Hardware",
  "Hardware Stores",
  "Health",
  "Health & Medical",
  "Health Markets",
  "Heating",
  "Heating & Air Conditioning/HVAC",
  "Herbal",
  "Herbal Shops",
  "Home & Garden",
  "Home Cleaning",
  "Home Decor",
  "Home Services",
  "Hotels",
  "Hotels & Travel",
  "HVAC",
  "Indoor",
  "Indoor Playcentre",
  "Internet Cafes",
  "Irish Pub",
  "IT",
  "IT Services & Computer Repair",
  "Jazz & Blues",
  "Jewelry",
  "Junk Removal & Hauling",
  "Kids Activities",
  "Kitchen & Bath",
  "Kitchen Supplies",
  "Laser",
  "Laser Tag",
  "Leisure Centers",
  "Lessons",
  "Life",
  "Local Flavor",
  "Local Services",
  "Lounges",
  "Mags",
  "Massage",
  "Maternity Wear",
  "Mental",
  "Mini Golf",
  "Motor",
  "Motorcycle Dealers",
  "Motorcycles",
  "Movies (Cinema)",
  "Museum",
  "Museums",
  "Music",
  "Music & DVDs",
  "Music & Video",
  "Music Venues",
  "Musicians",
  "Nail",
  "Nail Salons",
  "Nightlife",
  "Nurseries & Gardening",
  "Outdoor",
  "Outdoor Gear",
  "Parking",
  "Parks",
  "Party & Event Planning",
  "Party Equipment Rentals",
  "Party Supplies",
  "Performing Arts",
  "Personal Shopping",
  "Pet Adoption",
  "Pet Services",
  "Pet Sitting",
  "Pet Stores",
  "Pets",
  "Playcenter",
  "Playgrounds",
  "Pool",
  "Pool & Billiards",
  "Pool Halls",
  "Preschools",
  "Professional Services",
  "Public Markets",
  "Public Services & Government",
  "Pub",
  "Pubs",
  "Race",
  "Race Tracks",
  "Religious Organizations",
  "Repair",
  "Resorts",
  "Restaurants",
  "Roadside Assistance",
  "School",
  "Self Storage",
  "Service",
  "Shopping",
  "Shopping Centers",
  "Skating Rinks",
  "Skin Care",
  "Smog Check Stations",
  "Social Clubs",
  "Souvenir Shops",
  "Spas",
  "Sporting Goods",
  "Sports Bars",
  "Sports Clubs",
  "Sports Wear",
  "Stationery",
  "Strip Clubs",
  "Swimming Pools",
  "Tag",
  "Tapas Bars",
  "Tennis",
  "Themed Cafes",
  "Thrift Stores",
  "Tiki Bars",
  "Tires",
  "Tobacco Shops",
  "Tours",
  "Tracks",
  "Trailer Repair",
  "Transmission Repair",
  "Transportation",
  "Travel Services",
  "Used Bookstore",
  "Venues & Event Spaces",
  "Vehicles",
  "Vitamins & Supplements",
  "Waxing",
  "Wedding Planning",
  "Wholesale Stores",
  "Windshield Installation & Repair",
  "Wine & Spirits",
  "Wine Bars",
  "Wine Tasting Classes",
  "Wine Tasting Room",
  "Wineries",
  "Women's Clothing",
  "Wear",
  "Yelp Events",
  "Yoga",
];

export const FOOD_CATEGORIES = [
  "Acai Bowls",
  "Afghan",
  "African",
  "American (New)",
  "American (Traditional)",
  "Arabic",
  "Argentine",
  "Asian Fusion",
  "Austrian",
  "Bagels",
  "Bakeries",
  "Bar",
  "Barbeque",
  "Beer",
  "Beverage Store",
  "Bistros",
  "Brasseries",
  "Brazilian",
  "Breakfast & Brunch",
  "Breweries",
  "British",
  "Bubble Tea",
  "Buffets",
  "Burgers",
  "Burmese",
  "Butcher",
  "Cafes",
  "Cafeteria",
  "Cajun/Creole",
  "Cambodian",
  "Canadian (New)",
  "Candy Stores",
  "Cantonese",
  "Caterers",
  "Cheese Shops",
  "Cheesesteaks",
  "Chicken Shop",
  "Chicken Wings",
  "Chinese",
  "Chocolatiers & Shops",
  "Cideries",
  "Coffee & Tea",
  "Coffee Roasteries",
  "Colombian",
  "Comfort Food",
  "Convenience Stores",
  "Creperies",
  "Cuban",
  "Cupcakes",
  "Custom Cakes",
  "Delicatessen",
  "Delis",
  "Desserts",
  "Dim Sum",
  "Diners",
  "Distilleries",
  "Do-It-Yourself Food",
  "Donuts",
  "Empanadas",
  "Ethiopian",
  "Ethnic Food",
  "Falafel",
  "Farmers Market",
  "Fast Food",
  "Filipino",
  "Fish & Chips",
  "Fondue",
  "Food",
  "Food Court",
  "Food Delivery Services",
  "Food Stands",
  "Food Trucks",
  "French",
  "Fruits & Veggies",
  "Gelato",
  "German",
  "Gluten-Free",
  "Greek",
  "Grocery",
  "Hainan",
  "Halal",
  "Hawaiian",
  "Herbs & Spices",
  "Himalayan/Nepalese",
  "Hong Kong Style Cafe",
  "Hot Dogs",
  "Hot Pot",
  "Ice Cream & Frozen Yogurt",
  "Imported Food",
  "Indian",
  "Indonesian",
  "International",
  "International Grocery",
  "Irish",
  "Italian",
  "Japanese",
  "Japanese Curry",
  "Juice Bars & Smoothies",
  "Kebab",
  "Korean",
  "Kosher",
  "Laotian",
  "Latin American",
  "Lebanese",
  "Live/Raw Food",
  "Local Flavor",
  "Malaysian",
  "Meat Shops",
  "Mediterranean",
  "Mexican",
  "Middle Eastern",
  "Modern European",
  "Mongolian",
  "Moroccan",
  "New Mexican Cuisine",
  "Noodles",
  "Organic Stores",
  "Oriental",
  "Pakistani",
  "Pan Asian",
  "Pancakes",
  "Pasta Shops",
  "Patisserie/Cake Shop",
  "Persian/Iranian",
  "Personal Chefs",
  "Peruvian",
  "Pizza",
  "Poke",
  "Polish",
  "Pop-Up Restaurants",
  "Portuguese",
  "Poutineries",
  "Pretzels",
  "Ramen",
  "Restaurants",
  "Salad",
  "Salvadoran",
  "Sandwiches",
  "Sardinian",
  "Seafood",
  "Seafood Markets",
  "Senegalese",
  "Shanghainese",
  "Shaved Ice",
  "Shaved Snow",
  "Sicilian",
  "Singaporean",
  "Smokehouse",
  "Somali",
  "Soul Food",
  "Soup",
  "Southern",
  "Spanish",
  "Specialty Food",
  "Steakhouses",
  "Street Vendors",
  "Sushi Bars",
  "Syrian",
  "Szechuan",
  "Tacos",
  "Taiwanese",
  "Tapas Bars",
  "Tapas/Small Plates",
  "Tea Rooms",
  "Teppanyaki",
  "Tex-Mex",
  "Thai",
  "Themed Cafes",
  "Turkish",
  "Tuscan",
  "Ukrainian",
  "Vegan",
  "Vegetarian",
  "Venezuelan",
  "Vietnamese",
  "Waffles",
  "Wine & Spirits",
  "Wraps",
];

// ===============================
// âœ… Icon rules (corrigido para evitar conflitos e falsos positivos)
// ===============================
//
// Problemas que eu corrigi aqui:
// 1) Brasil tinha keywords bizarras ("point of interest", "establishment", "american (new)", "buffet") â†’ gerava ğŸ‡§ğŸ‡· pra tudo.
// 2) "mexican" aparecia em regra de bandeira E tambÃ©m em taco; entÃ£o eu deixei bandeira pra nacionalidade e taco pra comida.
// 3) Regras genÃ©ricas ("america", "usa") podem bater em qualquer texto â€” mantive mas vocÃª pode reduzir se quiser.
// 4) Dei prioridade para comida especÃ­fica (ğŸ£, ğŸ• etc.) ANTES de bandeira, pra nÃ£o virar â€œğŸ‡®ğŸ‡¹â€ em vez de â€œğŸ•â€.
//
// Regra de ouro: as primeiras vencem.
//
const CATEGORY_ICON_RULES = [
  // --- ÃCONES DE COMIDA (mais especÃ­ficos primeiro) ---
  { keywords: ["sushi"], icon: "ğŸ£" },
  { keywords: ["asian fusion"], icon: "ğŸ£" },
  { keywords: ["pizza"], icon: "ğŸ•" },
  { keywords: ["burger", "burgers", "cheesesteak"], icon: "ğŸ”" },
  { keywords: ["hot dog", "hot dogs"], icon: "ğŸŒ­" },
  { keywords: ["taco", "tex-mex"], icon: "ğŸŒ®" },
  { keywords: ["bbq", "barbeque", "barbecue", "smokehouse"], icon: "ğŸ–" },
  { keywords: ["chicken"], icon: "ğŸ—" },
  { keywords: ["steak"], icon: "ğŸ¥©" },
  { keywords: ["seafood", "fish", "oyster"], icon: "ğŸŸ" },
  { keywords: ["ramen", "noodle", "noodles", "pho", "soup"], icon: "ğŸœ" },
  { keywords: ["salad", "vegan", "vegetarian"], icon: "ğŸ¥—" },
  { keywords: ["sandwich", "sub", "wrap"], icon: "ğŸ¥ª" },
  { keywords: ["breakfast", "brunch", "pancake", "waffle"], icon: "ğŸ¥" },
  { keywords: ["coffee", "cafe", "cafes", "tea", "coffee & tea"], icon: "â˜•" },
  {
    keywords: ["dessert", "desserts", "ice cream", "frozen yogurt", "gelato", "donut", "donuts", "shaved ice"],
    icon: "ğŸ¨",
  },
  { keywords: ["bakery", "bakeries", "bread", "pastry", "cake", "cupcake", "patisserie"], icon: "ğŸ¥" },
  { keywords: ["bar", "pub", "lounge", "nightlife", "tapas"], icon: "ğŸ¸" },
  { keywords: ["beer", "brewery", "breweries", "cider", "wine", "spirits"], icon: "ğŸº" },
  { keywords: ["deli", "delicatessen", "cheese"], icon: "ğŸ§€" },
  { keywords: ["market", "grocery"], icon: "ğŸ›’" },
  { keywords: ["food truck", "food trucks", "street vendor", "street vendors"], icon: "ğŸšš" },
  { keywords: ["thai", "curry", "indian"], icon: "ğŸ›" },
  { keywords: ["italian", "pasta"], icon: "ğŸ" },
  { keywords: ["korean", "teppanyaki"], icon: "ğŸ¥¢" },
  { keywords: ["mediterranean", "greek"], icon: "ğŸ«’" },

  // --- BANDEIRAS (nacionalidade / culinÃ¡ria) ---
  { keywords: ["szechuan", "sichuan", "chinese"], icon: "ğŸ‡¨ğŸ‡³" },
  { keywords: ["japanese", "japan"], icon: "ğŸ‡¯ğŸ‡µ" },
  { keywords: ["korean", "korea"], icon: "ğŸ‡°ğŸ‡·" },
  { keywords: ["thai", "thailand"], icon: "ğŸ‡¹ğŸ‡­" },
  { keywords: ["indian", "india"], icon: "ğŸ‡®ğŸ‡³" },
  { keywords: ["vietnamese", "vietnam"], icon: "ğŸ‡»ğŸ‡³" },
  { keywords: ["filipino", "philippines"], icon: "ğŸ‡µğŸ‡­" },
  { keywords: ["indonesian", "indonesia"], icon: "ğŸ‡®ğŸ‡©" },
  { keywords: ["malaysian", "malaysia"], icon: "ğŸ‡²ğŸ‡¾" },
  { keywords: ["singaporean", "singapore"], icon: "ğŸ‡¸ğŸ‡¬" },
  { keywords: ["italian", "italy"], icon: "ğŸ‡®ğŸ‡¹" },
  { keywords: ["french", "france"], icon: "ğŸ‡«ğŸ‡·" },
  { keywords: ["greek", "greece"], icon: "ğŸ‡¬ğŸ‡·" },
  { keywords: ["spanish", "spain"], icon: "ğŸ‡ªğŸ‡¸" },
  { keywords: ["mexican", "mexico"], icon: "ğŸ‡²ğŸ‡½" },
  { keywords: ["canadian", "canada"], icon: "ğŸ‡¨ğŸ‡¦" },
  { keywords: ["american", "usa", "u.s.", "united states"], icon: "ğŸ‡ºğŸ‡¸" },
  { keywords: ["brazilian", "brazil"], icon: "ğŸ‡§ğŸ‡·" },
  { keywords: ["argentine", "argentina"], icon: "ğŸ‡¦ğŸ‡·" },
  { keywords: ["peruvian", "peru"], icon: "ğŸ‡µğŸ‡ª" },
  { keywords: ["colombian", "colombia"], icon: "ğŸ‡¨ğŸ‡´" },
  { keywords: ["venezuelan", "venezuela"], icon: "ğŸ‡»ğŸ‡ª" },
  { keywords: ["cuban", "cuba"], icon: "ğŸ‡¨ğŸ‡º" },
  { keywords: ["jamaican", "jamaica"], icon: "ğŸ‡¯ğŸ‡²" },
  { keywords: ["turkish", "turkey"], icon: "ğŸ‡¹ğŸ‡·" },
  { keywords: ["lebanese", "lebanon"], icon: "ğŸ‡±ğŸ‡§" },
  { keywords: ["moroccan", "morocco"], icon: "ğŸ‡²ğŸ‡¦" },
  { keywords: ["ethiopian", "ethiopia"], icon: "ğŸ‡ªğŸ‡¹" },
  { keywords: ["russian", "russia"], icon: "ğŸ‡·ğŸ‡º" },
  { keywords: ["german", "germany"], icon: "ğŸ‡©ğŸ‡ª" },
  { keywords: ["irish", "ireland"], icon: "ğŸ‡®ğŸ‡ª" },
  { keywords: ["english", "british", "uk", "u.k.", "england"], icon: "ğŸ‡¬ğŸ‡§" },
  { keywords: ["australian", "australia"], icon: "ğŸ‡¦ğŸ‡º" },
  { keywords: ["afghan", "afghanistan"], icon: "ğŸ‡¦ğŸ‡«" },
  { keywords: ["pakistani", "pakistan"], icon: "ğŸ‡µğŸ‡°" },
  { keywords: ["bangladeshi", "bangladesh"], icon: "ğŸ‡§ğŸ‡©" },
  { keywords: ["nepalese", "nepal"], icon: "ğŸ‡³ğŸ‡µ" },
];

// ===============================
// âœ… NormalizaÃ§Ã£o (conflitos corrigidos)
// ===============================
//
// Conflitos que eu corrigi aqui:
// 1) Pizza tinha "italian" â†’ roubava "Italian" (o seu bug).
// 2) American (New) e American (Traditional) tinham regras idÃªnticas (e genÃ©ricas) â†’ impossÃ­vel diferenciar.
// 3) Beer duplicado (2 regras "Beer").
// 4) Regras com termos genÃ©ricos demais ("restaurant", "store") causando match errado.
// 5) Hot Dogs tinha "pizza" e "burgers" (roubava categorias).
// 6) Brazilian tinha "american (new)", "buffet", "establishment", "point of interest" (roubava tudo).
//
// EstratÃ©gia:
// - Preferir termos ESPECÃFICOS (ex: pizza_restaurant) antes de termos amplos (ex: restaurant).
// - Evitar keywords â€œguarda-chuvaâ€: restaurant, store, establishment, point of interest.
// - Distinguir American (New) vs (Traditional) usando palavras realmente exclusivas.
// - Quando nÃ£o der para distinguir, NÃƒO tente: sÃ³ normalize para "American" OU deixe como estÃ¡.
//   (Aqui eu mantive os dois com keywords diferentes, mas sem â€œrestaurantâ€/â€œburgersâ€ lÃ¡ dentro.)
//
const escapeRegExp = (value) => value.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");

// Sufixos que devem ser removidos quando vier snake_case do Google Places/Yelp
const CATEGORY_SUFFIXES = new Set([
  "restaurant",
  "restaurants",
  "bar",
  "bars",
  "cafe",
  "cafes",
  "pub",
  "pubs",
  "store",
  "stores",
  "market",
  "markets",
]);

// âœ… regras principais (sem conflitos)
const MAIN_CATEGORY_RULES = [
  // --- Muito especÃ­ficos primeiro ---
  {
    label: "Ice Cream & Frozen Yogurt",
    keywords: ["ice cream & frozen yogurt", "frozen yogurt", "ice cream", "gelato", "shaved ice"],
  },
  { label: "Acai Bowls", keywords: ["acai bowls", "aÃ§aÃ­", "acai"] },
  { label: "Donuts", keywords: ["donuts", "donut"] },
  {
    label: "Bakeries",
    keywords: ["bakeries", "bakery", "patisserie", "patisserie/cake shop", "cake shop", "custom cakes", "cupcakes", "cupcake"],
  },

  // --- Cozinha / tipos ---
  {
    label: "Pizza",
    keywords: ["pizza_restaurant", "pizza"],
  },
  {
    label: "Burgers",
    keywords: ["hamburger_restaurant", "cheeseburger", "hamburger", "burgers", "burger"],
  },
  {
    label: "Hot Dogs",
    keywords: ["hot_dog_stand", "hot dogs", "hot dog"],
  },
  {
    label: "Barbeque",
    keywords: ["barbecue_restaurant", "bar_and_grill", "smokehouse", "barbecue", "barbeque", "bbq"],
  },
  {
    label: "Japanese",
    keywords: ["japanese_restaurant", "japanese curry", "teppanyaki", "sushi_restaurant", "sushi", "japanese"],
  },
  {
    label: "Italian",
    keywords: ["italian_restaurant", "italian", "pasta shops", "pasta shop"],
  },
  {
    label: "Spanish",
    keywords: ["tapas/small plates", "tapas bars", "tapas", "spanish_restaurant", "spanish"],
  },
  {
    label: "Mexican",
    keywords: ["tex-mex", "tacos", "taco", "mexican"],
  },
  {
    label: "Brazilian",
    keywords: ["brazilian", "brazil"],
  },
  {
    label: "Buffet",
    keywords: ["brazilian", "Buffets","buffet_restaurant"],
  },
  {
    label: "Asian Fusion",
    keywords: ["asian fusion"],
  },
  {
    label: "Seafood",
    keywords: ["seafood markets", "seafood market", "seafood"],
  },

  // --- Momentos / estilo ---
  {
    label: "Breakfast & Brunch",
    keywords: ["breakfast & brunch", "breakfast", "brunch", "pancakes", "waffles"],
  },
  {
    label: "Cafe",
    keywords: ["coffee roasteries", "coffee & tea", "bubble tea", "hong kong style cafe", "cafeteria", "cafes", "cafe", "coffee", "tea"],
  },

  // --- Bebidas / vida noturna ---
  {
    label: "Beer",
    keywords: ["beer gardens", "beer hall", "beer bar", "brewpub", "breweries", "brewery", "cideries", "cidery", "beer"],
  },
  {
    label: "Wine & Spirits",
    keywords: ["wine & spirits", "wine bar", "wine bars", "wineries", "winery", "spirits"],
  },
  {
    label: "Bar",
    keywords: ["cocktail bars", "sports bars", "bars", "bar", "pubs", "pub", "lounges", "lounge", "nightlife"],
  },

  // --- Lojas de bebida (separar de Beer/Bar) ---
  {
    label: "Beverage Store",
    keywords: ["beverage store"],
  },

  // --- American (New) vs Traditional (SEM termos genÃ©ricos) ---
  // Se suas fontes nÃ£o trazem "new american" vs "diner" etc, isso pode ficar fraco. Ainda assim, melhor que roubar tudo.
  {
    label: "American (New)",
    keywords: ["new american", "modern american", "american (new)"],
  },
  {
    label: "American (Traditional)",
    keywords: ["american (traditional)", "traditional american", "diner", "diners", "comfort food"],
  },
];

// âœ… compile regex com prioridade (ordem do array)
const MAIN_CATEGORY_REGEX_RULES = MAIN_CATEGORY_RULES.map((rule) => ({
  label: rule.label,
  patterns: rule.keywords
    .map((k) => String(k).trim())
    .filter(Boolean)
    .map((keyword) => new RegExp(`\\b${escapeRegExp(keyword.toLowerCase())}\\b`, "i")),
}));

const normalizeCategoryByKeyword = (value) => {
  const normalized = String(value).toLowerCase();
  for (const rule of MAIN_CATEGORY_REGEX_RULES) {
    if (rule.patterns.some((pattern) => pattern.test(normalized))) {
      return rule.label;
    }
  }
  return value;
};

const formatCategoryToken = (token) => {
  if (!token) return "";
  const trimmed = token.trim();
  if (!trimmed) return "";
  if (trimmed === trimmed.toUpperCase()) return trimmed;
  return trimmed.charAt(0).toUpperCase() + trimmed.slice(1);
};

export const normalizeCategoryLabel = (category = "") => {
  const raw = String(category).trim();
  if (!raw) return "";

  // Se jÃ¡ veio â€œbonitoâ€
  if (!raw.includes("_")) return normalizeCategoryByKeyword(raw);

  // Se veio snake_case (ex: italian_restaurant)
  const tokens = raw
    .split("_")
    .map((item) => item.trim())
    .filter(Boolean);

  if (!tokens.length) return raw;

  // Remove sufixos genÃ©ricos do final
  const last = tokens[tokens.length - 1]?.toLowerCase();
  if (last && CATEGORY_SUFFIXES.has(last)) {
    tokens.pop();
  }

  if (!tokens.length) return raw;

  const formatted = tokens.map(formatCategoryToken).join(" ");
  return normalizeCategoryByKeyword(formatted);
};

export const getCategoryIcon = (category = "") => {
  const normalized = String(category).toLowerCase();
  for (const rule of CATEGORY_ICON_RULES) {
    if (rule.keywords.some((keyword) => normalized.includes(String(keyword).toLowerCase()))) {
      return rule.icon;
    }
  }
  return "ğŸ½ï¸";
};
